##Java invoke C++ Example

###Build
* `make` 
* Mac OS X only, you might need to slightly modifiy the Makefile to work on Linux

###Run
* `java Sample1`
* result `evaluation result = 1.2374166638606414`

###Steps
* Create a Java Class which defines some native method you want to invoke in C++
```Java
public class Sample1
{
    public native double evaluate(double[] config);
}
```
* Generate a header file for C++ by typing the command `javah Sample1`
generated header file `Sample1.h`
```Cpp
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class Sample1 */

#ifndef _Included_Sample1
#define _Included_Sample1
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     Sample1
 * Method:    evaluate
 * Signature: ([D)D
 */
JNIEXPORT jdouble JNICALL Java_Sample1_evaluate
  (JNIEnv *, jobject, jdoubleArray);

#ifdef __cplusplus
}
#endif
#endif
```

* Write the C++ implementation, `evaluation.cpp`
```Cpp
#include "Sample1.h"
#include <cmath>
using namespace std;

JNIEXPORT jdouble JNICALL Java_Sample1_evaluate
  (JNIEnv * env, jobject obj, jdoubleArray array)
{
    double sum = 0.0;
    jsize len = env->GetArrayLength(array);
    if(len == 0) return sum;

    jdouble *body = env->GetDoubleArrayElements(array, 0);
    for(int i=0;i<len;i++) {
        sum += (body[i] * body[i]);
    }

    env->ReleaseDoubleArrayElements(array, body, 0);

    return sqrt(sum) / len;
}
```
* Compile the C++ implementation as a dynamic/shared library
 `clang++ -dynamiclib -o libevaluation.dylib evaluation.cpp  -I/System/Library/Frameworks/JavaVM.framework/Headers/`

* Write the Java invocation code in `Sample1.java` or anywhere else
```Java
public class Sample1
{
    // native method interface
    public native double evaluate(double[] config);

    public static void main(String[] args)
    {
        // load library, no prefix, no suffex 
        // both libevaluation.dylib libevaluation.so works
        System.loadLibrary("evaluation");
        // create new instance
        Sample1 sample = new Sample1();
        // invoke native (c/c++) method
        double value = sample.evaluate(new double[]{2.0, 3.0, -4.0, 2.8, 1.2});

        System.out.println("evaluation result = " + value);
    }
}
```

###Reference
* [Java Programming with JNI](http://www.ibm.com/developerworks/java/tutorials/j-jni/j-jni.html)


